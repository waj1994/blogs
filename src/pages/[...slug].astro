---
import { type CollectionEntry, getCollection } from 'astro:content'

import { SITE_DESCRIPTION, SITE_TITLE } from '../consts'
import BaseHead from '../components/BaseHead.astro'
import LeftNav from '../components/LeftNav.astro'
import Header from '../components/Header.astro'
import Toc from '../components/Toc.astro'
import MobileNav from '../components/MobileNav.astro'

export async function getStaticPaths() {
  const posts = await getCollection('slug')

  return posts.map((post) => ({
    params: { slug: `/${post.slug}` },
    props: post,
  }))
}

type Props = CollectionEntry<'slug'>

const post = Astro.props
const { headings, Content } = await post.render()
---

<html lang="zh-CN">
  <head>
    <BaseHead
      title={`${post.data.title} -${SITE_TITLE}`}
      description={SITE_DESCRIPTION}
    />
  </head>
  <body>
    <Header />

    <main
      class="min-h-[calc(100vh-var(--header-height))] mr-[calc(100vw-100%)]"
    >
      <div class="mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl">
        <div class="flex flex-col lg:grid lg:grid-cols-10 lg:gap-8">
          <div class="lg:col-span-2 shrink-0">
            <LeftNav />
          </div>
          <div class="lg:col-span-8">
            <div class="flex flex-col lg:grid lg:grid-cols-10 lg:gap-8">
              <div class="markdown-body lg:col-span-8 mt-8 pb-24 max-w-none">
                <h1>{post.data.title}</h1>
                <Content />
              </div>
              <div class="lg:col-span-2">
                <div
                  class="hidden lg:block order-first lg:order-last sticky top-[var(--header-height)] bg-background/75 backdrop-blur group -mx-4 sm:-mx-6 px-4 sm:px-6 lg:px-4 lg:-mx-4 overflow-y-auto max-h-[calc(100vh-var(--header-height))] z-10"
                >
                  <Toc headings={headings} />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    <MobileNav />
  </body>
</html>
